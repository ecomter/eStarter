<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:conv="clr-namespace:eStarter.Converters">

    <conv:BadgeVisibilityConverter x:Key="BadgeVisibilityConverter" />
    <conv:TileSizeToWidthConverter x:Key="TileSizeToWidthConverter" />
    <conv:TileSizeToHeightConverter x:Key="TileSizeToHeightConverter" />
    <conv:TileSizeToFontSizeConverter x:Key="TileSizeToFontSizeConverter" />
    <conv:TileSizeToVisibilityConverter x:Key="TileSizeToVisibilityConverter" />

    <!-- Metro Toggle Switch Style -->
    <Style x:Key="MetroToggleSwitchStyle" TargetType="ToggleButton">
        <Setter Property="Width" Value="60"/>
        <Setter Property="Height" Value="24"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToggleButton">
                    <Grid>
                        <Border x:Name="Track" 
                                Background="#FF666666" 
                                CornerRadius="12"
                                Padding="2">
                            <Canvas>
                                <Border x:Name="Thumb" 
                                        Width="20" Height="20" 
                                        CornerRadius="10"
                                        Background="White"
                                        Canvas.Left="0">
                                    <Border.RenderTransform>
                                        <TranslateTransform x:Name="ThumbTransform" X="0"/>
                                    </Border.RenderTransform>
                                </Border>
                            </Canvas>
                        </Border>

                        <!-- On/Off Text -->
                        <TextBlock x:Name="OnText" Text="On" 
                                   FontSize="10" Foreground="White"
                                   HorizontalAlignment="Left" VerticalAlignment="Center"
                                   Margin="8,0,0,0" Visibility="Collapsed"/>
                        <TextBlock x:Name="OffText" Text="Off" 
                                   FontSize="10" Foreground="White"
                                   HorizontalAlignment="Right" VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="Track" Property="Background" Value="{DynamicResource MetroAccentBrush}"/>
                            <Setter TargetName="OnText" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="OffText" Property="Visibility" Value="Collapsed"/>
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ThumbTransform"
                                                        Storyboard.TargetProperty="X"
                                                        To="36" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ThumbTransform"
                                                        Storyboard.TargetProperty="X"
                                                        To="0" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Track" Property="Opacity" Value="0.9"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Metro CheckBox Style -->
    <Style x:Key="MetroCheckBoxStyle" TargetType="CheckBox">
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="CheckBox">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border x:Name="CheckBorder" 
                                Width="20" Height="20"
                                BorderThickness="2"
                                BorderBrush="{DynamicResource MetroForegroundBrush}"
                                Background="Transparent">
                            <Grid>
                                <TextBlock x:Name="CheckMark" 
                                           Text="&#xE10B;"
                                           FontFamily="Segoe UI Symbol"
                                           FontSize="14"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           Opacity="0">
                                    <TextBlock.RenderTransform>
                                        <ScaleTransform x:Name="CheckMarkScale" ScaleX="0" ScaleY="0" CenterX="7" CenterY="7"/>
                                    </TextBlock.RenderTransform>
                                </TextBlock>
                            </Grid>
                        </Border>

                        <ContentPresenter Grid.Column="1" 
                                          Margin="10,0,0,0"
                                          VerticalAlignment="Center"
                                          RecognizesAccessKey="True"/>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="CheckBorder" Property="Background" Value="{DynamicResource MetroAccentBrush}"/>
                            <Setter TargetName="CheckBorder" Property="BorderBrush" Value="{DynamicResource MetroAccentBrush}"/>
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="CheckMark"
                                                        Storyboard.TargetProperty="Opacity"
                                                        To="1" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="CheckMarkScale"
                                                        Storyboard.TargetProperty="ScaleX"
                                                        To="1" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction>
                                                <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="CheckMarkScale"
                                                        Storyboard.TargetProperty="ScaleY"
                                                        To="1" Duration="0:0:0.15">
                                            <DoubleAnimation.EasingFunction>
                                                <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="CheckMark"
                                                        Storyboard.TargetProperty="Opacity"
                                                        To="0" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="CheckMarkScale"
                                                        Storyboard.TargetProperty="ScaleX"
                                                        To="0" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="CheckMarkScale"
                                                        Storyboard.TargetProperty="ScaleY"
                                                        To="0" Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="CheckBorder" Property="BorderBrush" Value="{DynamicResource MetroAccentBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Metro RadioButton Style -->
    <Style x:Key="MetroRadioButtonStyle" TargetType="RadioButton">
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="RadioButton">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border x:Name="RadioBorder" 
                                Width="20" Height="20"
                                CornerRadius="10"
                                BorderThickness="2"
                                BorderBrush="{DynamicResource MetroForegroundBrush}"
                                Background="Transparent">
                            <Ellipse x:Name="RadioDot"
                                     Width="10" Height="10"
                                     Fill="{DynamicResource MetroAccentBrush}"
                                     Opacity="0">
                                <Ellipse.RenderTransform>
                                    <ScaleTransform x:Name="RadioDotScale" ScaleX="0" ScaleY="0" CenterX="5" CenterY="5"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                        </Border>

                        <ContentPresenter Grid.Column="1" 
                                          Margin="10,0,0,0"
                                          VerticalAlignment="Center"
                                          RecognizesAccessKey="True"/>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="RadioBorder" Property="BorderBrush" Value="{DynamicResource MetroAccentBrush}"/>
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="RadioDot"
                                                        Storyboard.TargetProperty="Opacity"
                                                        To="1" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="RadioDotScale"
                                                        Storyboard.TargetProperty="ScaleX"
                                                        To="1" Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction>
                                                <BackEase EasingMode="EaseOut" Amplitude="0.4"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="RadioDotScale"
                                                        Storyboard.TargetProperty="ScaleY"
                                                        To="1" Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction>
                                                <BackEase EasingMode="EaseOut" Amplitude="0.4"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="RadioDot"
                                                        Storyboard.TargetProperty="Opacity"
                                                        To="0" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="RadioDotScale"
                                                        Storyboard.TargetProperty="ScaleX"
                                                        To="0" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="RadioDotScale"
                                                        Storyboard.TargetProperty="ScaleY"
                                                        To="0" Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="RadioBorder" Property="BorderBrush" Value="{DynamicResource MetroAccentBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Metro Header Text Style -->
    <Style x:Key="MetroHeaderTextStyle" TargetType="TextBlock">
        <Setter Property="FontFamily" Value="Microsoft YaHei Light, Segoe UI Light"/>
        <Setter Property="FontSize" Value="42"/>
        <Setter Property="FontWeight" Value="Light"/>
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="Margin" Value="0,0,0,10"/>
    </Style>

    <!-- Metro Subheader Text Style -->
    <Style x:Key="MetroSubheaderTextStyle" TargetType="TextBlock">
        <Setter Property="FontFamily" Value="Microsoft YaHei Light, Segoe UI Light"/>
        <Setter Property="FontSize" Value="20"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="Margin" Value="0,0,0,10"/>
    </Style>

    <!-- Metro Body Text Style -->
    <Style x:Key="MetroBodyTextStyle" TargetType="TextBlock">
        <Setter Property="FontSize" Value="18"/>
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="Opacity" Value="0.8"/>
        <Setter Property="TextWrapping" Value="Wrap"/>
    </Style>

    <!-- Metro Back Button Style -->
    <Style x:Key="MetroBackButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="BorderThickness" Value="2"/>
        <Setter Property="BorderBrush" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="Width" Value="48"/>
        <Setter Property="Height" Value="48"/>
        <Setter Property="FontSize" Value="24"/>
        <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
        <Setter Property="FontWeight" Value="Light"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Grid RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform x:Name="ScaleTransform" ScaleX="1" ScaleY="1"/>
                                <SkewTransform x:Name="SkewTransform" AngleX="0" AngleY="0"/>
                                <RotateTransform x:Name="RotateTransform" Angle="0"/>
                            </TransformGroup>
                        </Grid.RenderTransform>
                        
                        <Ellipse x:Name="Circle" 
                                 Stroke="{TemplateBinding BorderBrush}" 
                                 StrokeThickness="{TemplateBinding BorderThickness}"
                                 Fill="{TemplateBinding Background}"/>
                        
                        <ContentPresenter HorizontalAlignment="Center" 
                                        VerticalAlignment="Center" 
                                        Margin="0,-2,0,0"/>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Circle" Property="Fill" Value="{DynamicResource MetroSeparatorBrush}"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Circle" Property="Fill" Value="{DynamicResource MetroAccentBrush}"/>
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <!-- Simulate 3D Flip/Tilt using non-uniform scale and skew -->
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleX" 
                                                       To="0.7" 
                                                       Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleY" 
                                                       To="0.9" 
                                                       Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="SkewTransform" 
                                                       Storyboard.TargetProperty="AngleY" 
                                                       To="-5" 
                                                       Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleX" 
                                                       To="1.0" 
                                                       Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <ElasticEase Oscillations="1" Springiness="6"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleY" 
                                                       To="1.0" 
                                                       Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <ElasticEase Oscillations="1" Springiness="6"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="SkewTransform" 
                                                       Storyboard.TargetProperty="AngleY" 
                                                       To="0" 
                                                       Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <ElasticEase Oscillations="1" Springiness="6"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Metro Tile Style (Moved from MainWindow) -->
    <Style x:Key="MetroTileStyle" TargetType="Button">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Margin" Value="6" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Width" Value="{Binding TileSize, Converter={StaticResource TileSizeToWidthConverter}}" />
        <Setter Property="Height" Value="{Binding TileSize, Converter={StaticResource TileSizeToHeightConverter}}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Grid x:Name="RootGrid" RenderTransformOrigin="0.5,0.5" ClipToBounds="False">
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform x:Name="ScaleTransform" ScaleX="1" ScaleY="1" />
                            </TransformGroup>
                        </Grid.RenderTransform>
                        
                        <!-- Main Tile Background -->
                        <Border x:Name="TileBorder" 
                                Background="{Binding Background}"
                                BorderThickness="0">
                        </Border>

                        <!-- Metro Hover Overlay -->
                        <Border x:Name="HoverOverlay" 
                                Background="White" 
                                Opacity="0"/>

                        <!-- Metro Press Overlay -->
                        <Border x:Name="PressOverlay" 
                                Background="Black" 
                                Opacity="0"/>

                        <!-- Content Grid -->
                        <Grid Margin="15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="1" 
                                       VerticalAlignment="Bottom"
                                       Visibility="{Binding TileSize, Converter={StaticResource TileSizeToVisibilityConverter}, ConverterParameter=small}">
                                <TextBlock Text="{Binding Name}" 
                                          FontWeight="Light" 
                                          FontSize="{Binding TileSize, Converter={StaticResource TileSizeToFontSizeConverter}}"
                                          Foreground="White" 
                                          TextWrapping="Wrap"
                                          TextTrimming="CharacterEllipsis"
                                          LineHeight="20"
                                          LineStackingStrategy="BlockLineHeight"/>
                                
                                <TextBlock Text="{Binding Description}" 
                                          FontWeight="Light"
                                          FontSize="11"
                                          Foreground="#CCFFFFFF" 
                                          TextWrapping="Wrap"
                                          Margin="0,4,0,0"
                                          TextTrimming="CharacterEllipsis"
                                          Visibility="{Binding TileSize, Converter={StaticResource TileSizeToVisibilityConverter}, ConverterParameter=description}"/>
                            </StackPanel>
                        </Grid>

                        <!-- Badge -->
                        <Border x:Name="Badge" 
                                Background="#FFCC0000" 
                                MinWidth="24" 
                                Height="24" 
                                Padding="6,0"
                                HorizontalAlignment="Right" 
                                VerticalAlignment="Top" 
                                Margin="0,6,6,0"
                                Visibility="{Binding BadgeCount, Converter={StaticResource BadgeVisibilityConverter}}">
                            <TextBlock Text="{Binding BadgeCount}" 
                                      Foreground="White" 
                                      FontSize="12"
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                        </Border>

                        <!-- Context Menu -->
                        <Grid.ContextMenu>
                            <ContextMenu Background="#FF2D2D30" BorderBrush="#FF3F3F46">
                                <MenuItem Header="Resize" 
                                         Command="{Binding DataContext.ChangeTileSizeCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                         CommandParameter="{Binding}"
                                         Foreground="White"
                                         Background="#FF2D2D30"/>
                                <MenuItem Header="Change color" 
                                         Command="{Binding DataContext.ChangeTileColorCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                         CommandParameter="{Binding}"
                                         Foreground="White"
                                         Background="#FF2D2D30"/>
                            </ContextMenu>
                        </Grid.ContextMenu>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="HoverOverlay" 
                                                       Storyboard.TargetProperty="Opacity" 
                                                       To="0.08" 
                                                       Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="HoverOverlay" 
                                                       Storyboard.TargetProperty="Opacity" 
                                                       To="0" 
                                                       Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>

                        <Trigger Property="IsPressed" Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="PressOverlay" 
                                                       Storyboard.TargetProperty="Opacity" 
                                                       To="0.15" 
                                                       Duration="0:0:0"/>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleX" 
                                                       To="0.98" 
                                                       Duration="0:0:0.05"/>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleY" 
                                                       To="0.98" 
                                                       Duration="0:0:0.05"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="PressOverlay" 
                                                       Storyboard.TargetProperty="Opacity" 
                                                       To="0" 
                                                       Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleX" 
                                                       To="1.0" 
                                                       Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                                                       Storyboard.TargetProperty="ScaleY" 
                                                       To="1.0" 
                                                       Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Settings ListBox Item Style -->
    <Style x:Key="SettingsListBoxItemStyle" TargetType="ListBoxItem">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
        <Setter Property="Opacity" Value="0.8"/>
        <Setter Property="FontSize" Value="16"/>
        <Setter Property="FontFamily" Value="Microsoft YaHei, Segoe UI"/>
        <Setter Property="Padding" Value="10,8"/>
        <Setter Property="Margin" Value="0,0,0,2"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}"/>
                            <Setter Property="Opacity" Value="1.0"/>
                            <Setter Property="Background" Value="#19888888"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{DynamicResource MetroAccentBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Opacity" Value="1.0"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Metro ComboBox Toggle Button -->
    <ControlTemplate x:Key="MetroComboBoxToggleButton" TargetType="ToggleButton">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="32" />
            </Grid.ColumnDefinitions>
            <Border x:Name="Border" 
                    Grid.ColumnSpan="2"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}" />
            
            <Path x:Name="Arrow" 
                  Grid.Column="1" 
                  Fill="{TemplateBinding Foreground}"
                  HorizontalAlignment="Center" 
                  VerticalAlignment="Center"
                  Data="M0,0 L8,8 L16,0"
                  StrokeThickness="2"
                  Stretch="None"/>
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#FF3F3F46" />
            </Trigger>
            <Trigger Property="IsChecked" Value="True">
                <Setter TargetName="Border" Property="Background" Value="{DynamicResource MetroAccentBrush}" />
                <Setter TargetName="Arrow" Property="Fill" Value="White" />
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- Metro ComboBox Item Style -->
    <Style x:Key="MetroComboBoxItemStyle" TargetType="ComboBoxItem">
        <Setter Property="SnapsToDevicePixels" Value="True" />
        <Setter Property="Padding" Value="10,8" />
        <Setter Property="HorizontalContentAlignment" Value="Left" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBoxItem">
                    <Border x:Name="Bd" 
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Padding="{TemplateBinding Padding}"
                            SnapsToDevicePixels="True">
                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="#FF3F3F46" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource MetroAccentBrush}" />
                            <Setter Property="Foreground" Value="White" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Metro ComboBox Style -->
    <Style x:Key="MetroComboBoxStyle" TargetType="ComboBox">
        <Setter Property="Foreground" Value="{DynamicResource MetroForegroundBrush}" />
        <Setter Property="Background" Value="{DynamicResource MetroBackgroundBrush}" />
        <Setter Property="BorderBrush" Value="#FF3F3F46" />
        <Setter Property="BorderThickness" Value="2" />
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto" />
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
        <Setter Property="Padding" Value="10,6" />
        <Setter Property="ScrollViewer.CanContentScroll" Value="true" />
        <Setter Property="ScrollViewer.PanningMode" Value="Both" />
        <Setter Property="Stylus.IsFlicksEnabled" Value="False" />
        <Setter Property="ItemContainerStyle" Value="{StaticResource MetroComboBoxItemStyle}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBox">
                    <Grid x:Name="templateRoot" SnapsToDevicePixels="true">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition MinWidth="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}" Width="0" />
                        </Grid.ColumnDefinitions>
                        
                        <Popup x:Name="PART_Popup" 
                               AllowsTransparency="true" 
                               Grid.ColumnSpan="2" 
                               IsOpen="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" 
                               Margin="1" 
                               PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}" 
                               Placement="Bottom">
                            <Border x:Name="dropDownBorder" 
                                    Background="{DynamicResource MetroBackgroundBrush}" 
                                    BorderBrush="{DynamicResource MetroAccentBrush}" 
                                    BorderThickness="1" 
                                    MaxHeight="{TemplateBinding MaxDropDownHeight}" 
                                    MinWidth="{Binding ActualWidth, ElementName=templateRoot}">
                                <ScrollViewer x:Name="DropDownScrollViewer">
                                    <Grid x:Name="grid" RenderOptions.ClearTypeHint="Enabled">
                                        <Canvas x:Name="canvas" HorizontalAlignment="Left" Height="0" VerticalAlignment="Top" Width="0">
                                            <Rectangle x:Name="opaqueRect" Fill="{Binding Background, ElementName=dropDownBorder}" Height="{Binding ActualHeight, ElementName=dropDownBorder}" Width="{Binding ActualWidth, ElementName=dropDownBorder}" />
                                        </Canvas>
                                        <ItemsPresenter x:Name="ItemsPresenter" KeyboardNavigation.DirectionalNavigation="Contained" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                    </Grid>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                        
                        <ToggleButton x:Name="toggleButton" 
                                      Background="{TemplateBinding Background}" 
                                      BorderBrush="{TemplateBinding BorderBrush}" 
                                      BorderThickness="{TemplateBinding BorderThickness}" 
                                      Grid.ColumnSpan="2" 
                                      IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                      Template="{StaticResource MetroComboBoxToggleButton}"
                                      Foreground="{TemplateBinding Foreground}"/>
                        
                        <ContentPresenter x:Name="contentPresenter" 
                                          ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}" 
                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" 
                                          Content="{TemplateBinding SelectionBoxItem}" 
                                          ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" 
                                          IsHitTestVisible="false" 
                                          Margin="{TemplateBinding Padding}" 
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="HasItems" Value="false">
                            <Setter TargetName="dropDownBorder" Property="Height" Value="95" />
                        </Trigger>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsGrouping" Value="true" />
                                <Condition Property="VirtualizingPanel.IsVirtualizingWhenGrouping" Value="false" />
                            </MultiTrigger.Conditions>
                            <Setter Property="ScrollViewer.CanContentScroll" Value="false" />
                        </MultiTrigger>
                        <Trigger Property="ScrollViewer.CanContentScroll" Value="false">
                            <Setter TargetName="DropDownScrollViewer" Property="Canvas.Top" Value="{Binding VerticalOffset, ElementName=DropDownScrollViewer}" />
                            <Setter TargetName="DropDownScrollViewer" Property="Canvas.Left" Value="{Binding HorizontalOffset, ElementName=DropDownScrollViewer}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>