<UserControl x:Class="eStarter.Views.SettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:eStarter.ViewModels"
             xmlns:settings="clr-namespace:eStarter.Views.Settings"
             FontFamily="Microsoft YaHei, Segoe UI">

    <UserControl.Resources>
        <!-- Win8-style content entrance: fade + slide up -->
        <Style x:Key="PanelEntranceStyle" TargetType="UserControl">
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform Y="0"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="Visibility" Value="Visible">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                From="0" To="1" Duration="0:0:0.25">
                                    <DoubleAnimation.EasingFunction>
                                        <CubicEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                                From="30" To="0" Duration="0:0:0.3">
                                    <DoubleAnimation.EasingFunction>
                                        <CubicEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <UserControl.DataContext>
        <local:SettingsViewModel/>
    </UserControl.DataContext>

    <Grid Background="{DynamicResource MetroBackgroundBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="340"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Sidebar - Category List -->
        <Border Grid.Column="0" 
                Background="{DynamicResource MetroBackgroundBrush}" 
                BorderBrush="{DynamicResource MetroSeparatorBrush}" 
                BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Margin="90,30,20,30">
                    <TextBlock Text="PC settings" 
                               FontFamily="Microsoft YaHei Light, Segoe UI Light"
                               FontSize="40" FontWeight="Light"
                               Foreground="{DynamicResource MetroForegroundBrush}"/>
                </StackPanel>

                <!-- Category List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="10,0,0,0">
                    <ItemsControl ItemsSource="{Binding Categories}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Command="{Binding DataContext.SelectCategoryCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Cursor="Hand"
                                        Margin="0,0,0,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bd" 
                                                    Background="Transparent"
                                                    BorderThickness="4,0,0,0"
                                                    BorderBrush="Transparent"
                                                    Padding="16,12,20,12">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Title}" 
                                                               FontSize="18" FontWeight="Normal"
                                                               Foreground="{DynamicResource MetroForegroundBrush}"
                                                               Margin="0,0,0,2"/>
                                                    <TextBlock Text="{Binding Description}" 
                                                               FontSize="12" 
                                                               Foreground="{DynamicResource MetroForegroundBrush}"
                                                               Opacity="0.6" 
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter TargetName="bd" Property="Background" Value="{DynamicResource MetroAccentBrush}"/>
                                                    <Setter TargetName="bd" Property="BorderBrush" Value="{DynamicResource MetroAccentBrush}"/>
                                                </DataTrigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding IsSelected}" Value="False"/>
                                                        <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter TargetName="bd" Property="Background" Value="{DynamicResource MetroSeparatorBrush}"/>
                                                </MultiDataTrigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Right Content Area -->
        <Grid Grid.Column="1" Margin="40,50,40,40">
            <!-- Personalize Panel -->
            <settings:PersonalizePanel x:Name="PersonalizePanel" 
                                        Style="{StaticResource PanelEntranceStyle}"
                                        DataContext="{Binding}"
                                        Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=Personalize}"/>

            <!-- Users Panel -->
            <settings:UsersPanel x:Name="UsersPanel"
                                  Style="{StaticResource PanelEntranceStyle}"
                                  DataContext="{Binding}"
                                  Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=Users}"/>

            <!-- Notifications Panel -->
            <settings:NotificationsPanel x:Name="NotificationsPanel"
                                          Style="{StaticResource PanelEntranceStyle}"
                                          DataContext="{Binding}"
                                          Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=Notifications}"/>

            <!-- Apps Panel -->
            <settings:AppsPanel x:Name="AppsPanel"
                                 Style="{StaticResource PanelEntranceStyle}"
                                 DataContext="{Binding}"
                                 Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=Apps}"/>

            <!-- Privacy Panel -->
            <settings:PrivacyPanel x:Name="PrivacyPanel"
                                    Style="{StaticResource PanelEntranceStyle}"
                                    DataContext="{Binding}"
                                    Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=Privacy}"/>

            <!-- Time and Language Panel -->
            <settings:TimeLanguagePanel x:Name="TimeLanguagePanel"
                                         Style="{StaticResource PanelEntranceStyle}"
                                         DataContext="{Binding}"
                                         Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=TimeLanguage}"/>

            <!-- Update Panel -->
            <settings:UpdatePanel x:Name="UpdatePanel"
                                   Style="{StaticResource PanelEntranceStyle}"
                                   DataContext="{Binding}"
                                   Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=Update}"/>

            <!-- About Panel -->
            <settings:AboutPanel x:Name="AboutPanel"
                                  Style="{StaticResource PanelEntranceStyle}"
                                  DataContext="{Binding}"
                                  Visibility="{Binding SelectedCategory.Id, Converter={StaticResource CategoryToVisibilityConverter}, ConverterParameter=About}"/>

            <!-- Placeholder for EaseOfAccess only -->
            <StackPanel x:Name="PlaceholderPanel">
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedCategory.Id}" Value="EaseOfAccess">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>

                <TextBlock Text="{Binding SelectedCategory.Title}" 
                           FontFamily="Microsoft YaHei Light, Segoe UI Light"
                           FontSize="42" FontWeight="Light"
                           Foreground="{DynamicResource MetroForegroundBrush}"
                           Margin="0,0,0,30"/>

                <TextBlock Text="This section is under development." 
                           FontSize="14"
                           Foreground="{DynamicResource MetroForegroundBrush}"
                           Opacity="0.7"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>