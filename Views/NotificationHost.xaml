<UserControl x:Class="eStarter.Views.NotificationHost"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:services="clr-namespace:eStarter.Services"
             xmlns:conv="clr-namespace:eStarter.Converters"
             mc:Ignorable="d"
             IsHitTestVisible="True">

    <UserControl.Resources>
        <conv:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        
        <!-- Toast Animation -->
        <Storyboard x:Key="ToastEnterAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.3"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)"
                           From="400" To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <!-- Notification Container (top-right) -->
    <ItemsControl x:Name="NotificationList"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Top"
                  Margin="0,60,20,0"
                  Width="380">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel Orientation="Vertical"/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>

        <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type services:NotificationItem}">
                <Border x:Name="ToastBorder"
                        Background="#FF1F1F1F"
                        MinWidth="320"
                        MaxWidth="380"
                        Margin="0,0,0,8"
                        Padding="16"
                        Cursor="Hand"
                        Opacity="0"
                        RenderTransformOrigin="1,0.5"
                        MouseLeftButtonDown="Toast_Click">
                    <Border.RenderTransform>
                        <TranslateTransform X="400"/>
                    </Border.RenderTransform>
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="2" BlurRadius="8" Opacity="0.3"/>
                    </Border.Effect>
                    <Border.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                   From="0" To="1" Duration="0:0:0.3"/>
                                    <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(TranslateTransform.X)"
                                                   From="400" To="0" Duration="0:0:0.3">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Border.Triggers>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Accent bar -->
                        <Border Grid.Column="0" 
                                Width="4" 
                                Margin="-16,-16,12,-16"
                                Background="{Binding AccentColor}"/>

                        <!-- Icon -->
                        <TextBlock Grid.Column="0" 
                                   Text="{Binding Icon}" 
                                   FontFamily="Segoe UI Symbol" 
                                   FontSize="20"
                                   Foreground="{Binding AccentColor}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,12,0"/>

                        <!-- Content -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Title}" 
                                       FontWeight="SemiBold" 
                                       FontSize="14"
                                       Foreground="White"
                                       TextTrimming="CharacterEllipsis"/>
                            <TextBlock Text="{Binding Message}" 
                                       FontSize="12"
                                       Foreground="#CCFFFFFF"
                                       TextWrapping="Wrap"
                                       MaxHeight="40"
                                       TextTrimming="CharacterEllipsis"
                                       Margin="0,4,0,0"/>
                            <TextBlock Text="{Binding AppId}" 
                                       FontSize="10"
                                       Foreground="#66FFFFFF"
                                       Margin="0,4,0,0"
                                       Visibility="{Binding AppId, Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- Close Button -->
                        <Button Grid.Column="2" 
                                Content="&#xE10A;" 
                                FontFamily="Segoe UI Symbol"
                                FontSize="12"
                                Background="Transparent"
                                Foreground="#99FFFFFF"
                                BorderThickness="0"
                                Padding="8"
                                Cursor="Hand"
                                VerticalAlignment="Top"
                                Margin="8,-8,-8,0"
                                Click="CloseButton_Click"
                                Tag="{Binding Id}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>
